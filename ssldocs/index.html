<!doctype html>
</html>
<head>
	<meta charset="utf-8">
	<title>Azimuth IMGX-viewer</title>
	<link rel="stylesheet" href="css/ext/bootstrap-3.3.7.min.css">
	<script src="js/ext/vue-2.5.2.min.js"></script>
	<style>

#imgx-input-label {
	display: block;
	position: absolute;
	top: 5%;
	left: 25%;
	width: 50%;
}

#imgx-input-label:hover { cursor: pointer; }

#imgx-input-label img { width: 100%; }

#imgx-input { display: none; }

	</style>
</head>
<body onload="setComposer(true)">
	<div id="initial-frame">
		<label id="imgx-input-label" for="imgx-input">
			<img src="images/feather/file.svg">
		</label>
		<input id="imgx-input" type="file" accept=".imgf,.imgv,.imgx" onchange="expandFile(this)">
	</div>

	
<!-- block head -->
	<!-- <link rel="stylesheet" href="css/ext/bootstrap-4.0.0.min.css"> -->
	<link rel="stylesheet" href="css/player.css">
	<!-- <script src="js/ext/vue-2.5.2.min.js"></script> -->
	<script src="js/ext/bufferpack.js"></script>
	<script src="js/ext/untar.js"></script>
	<script src="js/lib/gluon.js"></script>
	<script src="js/lib/handy.js"></script>
	<script src="js/fragments/imgf.js"></script>
	<script src="js/fragments/imgx.js"></script>
	<script src="js/player/composer.js"></script>
<!-- endblock -->

<!-- block body -->

	
<!-- block head -->
	<script src="js/player/imgx-player.js"></script>
<!-- endblock -->

<!-- block body -->
	<template id="imgx-player-template">
		<div id="app-imgx-player">
			<video width="100%" onclick="composer.currentPlayer.playSwitch()">
				<!-- <source src="detail.mp4"> -->
			</video>
			<div class="phasebar"></div>
			<progress class="scrubber" v-bind:value="progress"></progress>
			<div class="controlbar">
				<button class="btn btn-default" onclick="composer.currentPlayer.shiftFrame()"><img src="images/feather/skip-back.svg"></button>
				<button class="btn btn-default" onclick="composer.currentPlayer.playSwitch()"><img src="images/feather-ext/play-pause.svg"></button>
				<button class="btn btn-default" onclick="composer.currentPlayer.shiftFrame(true)"><img src="images/feather/skip-forward.svg"></button>
				<div class="right">
					<div class="times-bind">
						<span class="time">0.00</span><span> / </span> <span class="duration">0.00</span>
					</div>
					<div class="phase-id"></div>
					<button class="btn btn-default" onclick="composer.switchPlayerSize()"><img src="images/feather/maximize.svg"></button>
				</div>
			</div>
		</div>
	</template>
<!-- endblock -->

	
<!-- block head -->
	<script src="js/player/imgf-player.js"></script>
<!-- endblock -->

<!-- block body -->
	<template id="imgf-player-template">
		<div id="app-imgf-player">

			<img class="imgf" width="100%" onclick="composer.currentPlayer.playSwitch()">

			<div class="phasebar"></div>
			<progress class="scrubber" v-bind:value="progress"></progress>
			<div class="controlbar">
				<button class="btn btn-default" onclick="composer.currentPlayer.shiftFrame()"><img src="images/feather/skip-back.svg"></button>
				<button class="btn btn-default" onclick="composer.currentPlayer.playSwitch()"><img src="images/feather-ext/play-pause.svg"></button>
				<button class="btn btn-default" onclick="composer.currentPlayer.shiftFrame(true)"><img src="images/feather/skip-forward.svg"></button>
				<div class="right">
					<div class="times-bind">
						<span class="time">0.00</span><span> / </span> <span class="duration">0.00</span>
					</div>
					<div class="phase-id"></div>
					<button class="btn btn-default" onclick="composer.switchPlayerSize()"><img src="images/feather/maximize.svg"></button>
				</div>
			</div>
		</div>
	</template>
<!-- endblock -->

	
<!-- block head -->
	<script src="js/player/jpeg-player.js"></script>
<!-- endblock -->

<!-- block body -->
	<template id="jpeg-player-template">
		<div id="app-jpeg-player">
			<img class="jpeg" width="100%" onclick="composer.switchPlayerSize()">
		</div>
	</template>
<!-- endblock -->


	<div id="app-composer" v-show="visible">
		<div id="fragment-player-slot" v-if="player">
			<component v-bind:is="player"
				:progress="progress"
				:phases="phases">
			</component>
		</div>
		<div id="metadata" v-cloak>
			<div v-show="Object.keys(violations).length">
				<div v-if="entireGui">
					<select class="form-control" v-model="menu.violation">
						<option v-for="(value, id) in violations" v-bind:value="value">
							{{ id }}
						</option>
					</select>
					<button class="btn btn-default" v-on:click="showXML()"><img src="images/feather/file-text.svg" /></button>
				</div><div>
					<select class="form-control" v-model="menu.stream">
						<option v-for="stream in streams" v-bind:value="stream">
							{{ stream.display_name }}
						</option>
					</select>
					<button class="btn btn-default" v-on:click="saveStream()"><img src="images/feather/save.svg" /></button>
				</div>
			</div>
			<ul>
				<li v-for="data in meta">
					{{ "{key}: {value}".format(data) }}
				</li>
			</ul>
		</div>
	</div>
<!-- endblock -->


	<script>

addEventListener("load", () => {
	let filename = process.argv.slice(-1)[0];

	openIfIMGX(filename);
});

for (let event of ["dragover", "dragleave", "dragend"]) {
	addEventListener(event, (event) => {
		event.preventDefault();
	});
}

addEventListener("drop", (event) => {
	if (event.dataTransfer.files.length) {
		event.preventDefault();

		let filename = event.dataTransfer.files[0].path;

		openIfIMGX(filename);
	}
});

let openIfIMGX = (function () {
	let __path = require("path"),
		extensions = [
		".imgx",
		".imgf",
		".imgv"
	];
	return (function (filename) {
		if (extensions.indexOf(__path.extname(filename)) > -1) {
			expandPath(filename);
		}
	});
})();

let expandPath = (function () {
	let __fs = require("fs");
	return (function (filename) {
		__fs.access(filename, () => {
			__fs.readFile(filename, (err, arrayBuffer) => {
				hideInputOverlay();
				composer.visible = true;

				composer.expandFile(new File([new Blob([new Uint8Array(arrayBuffer)])], filename));
			});
		});
	});
})();


function hideInputOverlay() {
	document.querySelector("#initial-frame").style.display = "none";
}

function expandFile(element) {
	let file = element.files[0];
	if (file) {
		hideInputOverlay();
		composer.visible = true;

		composer.expandFile(file);
	}
}

	</script>
</body>
</html>